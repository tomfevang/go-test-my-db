tables:
  AccountCheck:
    columns:
      companyId: '{{Number 1 5000}}'
      details: |-
        {"region": "{{RandomString (SliceString "EMEA" "APAC" "NAM" "LATAM")}}", "source": "{{RandomString (SliceString "ERP" "BANK" "MANUAL")}}"}
      anomalyType: '{{RandomString (SliceString "DUPLICATE" "MISSING" "MISMATCH" "OUTLIER" "STALE")}}'
      accountNumber: '{{Numerify "####-####-##"}}'

  AccountAnomaly:
    columns:
      accountCheckId: '{{Number 1 100000}}'
      details: |-
        {"severity": "{{RandomString (SliceString "LOW" "MEDIUM" "HIGH" "CRITICAL")}}", "amount": {{Number 0 100}}, "message": "{{HackerPhrase}}"}
      date: '{{printf "%04d-%02d-%02d" (Number 2020 2025) (Number 1 12) (Number 1 28)}}'
      status: '{{RandomString (SliceString "OPEN" "INVESTIGATING" "RESOLVED" "DISMISSED")}}'

tests:
  # --- 1 WHERE condition ---
  - name: "1 cond: generated col"
    query: "SELECT id, _severity, date, status FROM AccountAnomaly WHERE _severity = 'CRITICAL'"
    repeat: 500
  - name: "1 cond: JSON path"
    query: "SELECT id, details->>'$.severity' AS severity, date, status FROM AccountAnomaly WHERE details->>'$.severity' = 'CRITICAL'"
    repeat: 500

  # --- 2 WHERE conditions ---
  - name: "2 cond: generated col + date"
    query: "SELECT id, _severity, date, status FROM AccountAnomaly WHERE _severity = 'HIGH' AND date >= '2023-01-01'"
    repeat: 500
  - name: "2 cond: JSON path + date"
    query: "SELECT id, details->>'$.severity' AS severity, date, status FROM AccountAnomaly WHERE details->>'$.severity' = 'HIGH' AND date >= '2023-01-01'"
    repeat: 500

  # --- 3 WHERE conditions ---
  - name: "3 cond: generated col + status + date"
    query: "SELECT id, _severity, date, status, _amount FROM AccountAnomaly WHERE _severity = 'HIGH' AND status = 'OPEN' AND date >= '2023-01-01'"
    repeat: 500
  - name: "3 cond: JSON path + status + date"
    query: "SELECT id, details->>'$.severity' AS severity, date, status, details->'$.amount' AS amount FROM AccountAnomaly WHERE details->>'$.severity' = 'HIGH' AND status = 'OPEN' AND date >= '2023-01-01'"
    repeat: 500

  # --- 4 WHERE conditions ---
  - name: "4 cond: generated col + status + date + amount"
    query: "SELECT id, _severity, date, status, _amount FROM AccountAnomaly WHERE _severity = 'HIGH' AND status = 'OPEN' AND date >= '2023-01-01' AND _amount > 50"
    repeat: 500
  - name: "4 cond: JSON path + status + date + amount"
    query: "SELECT id, details->>'$.severity' AS severity, date, status, details->'$.amount' AS amount FROM AccountAnomaly WHERE details->>'$.severity' = 'HIGH' AND status = 'OPEN' AND date >= '2023-01-01' AND details->'$.amount' > 50"
    repeat: 500

  # --- Off-index queries (no composite starts with these) ---
  - name: "off-index: status + date"
    query: "SELECT id, _severity, date, status FROM AccountAnomaly WHERE status = 'OPEN' AND date >= '2023-01-01'"
    repeat: 500
  - name: "off-index: amount range"
    query: "SELECT id, _severity, date, status, _amount FROM AccountAnomaly WHERE _amount > 50"
    repeat: 500
  - name: "off-index: status + amount"
    query: "SELECT id, _severity, date, status, _amount FROM AccountAnomaly WHERE status = 'OPEN' AND _amount > 50"
    repeat: 500
