tables:
  AccountCheckStar:
    columns:
      companyId: '{{Number 1 5000}}'
      anomalyType: '{{RandomString (SliceString "DUPLICATE" "MISSING" "MISMATCH" "OUTLIER" "STALE")}}'
      accountNumber: '{{Numerify "####-####-##"}}'
      regionId: '{{Number 1 4}}'
      sourceId: '{{Number 1 3}}'

  AccountAnomalyStar:
    columns:
      accountCheckId: '{{Number 1 100000}}'
      severityId: '{{Number 1 4}}'
      statusId: '{{Number 1 4}}'
      date: '{{printf "%04d-%02d-%02d" (Number 2020 2025) (Number 1 12) (Number 1 28)}}'
      amount: '{{Number 0 100}}'
      message: '{{HackerPhrase}}'

tests:
  # --- 1 WHERE condition (1 JOIN to resolve severity name) ---
  - name: "1 cond: severityId"
    query: "SELECT a.id, s.name AS severity, a.date, st.name AS status FROM AccountAnomalyStar a JOIN DimSeverity s ON s.id = a.severityId JOIN DimStatus st ON st.id = a.statusId WHERE a.severityId = 4"
    repeat: 500

  # --- 2 WHERE conditions ---
  - name: "2 cond: severityId + date"
    query: "SELECT a.id, s.name AS severity, a.date, st.name AS status FROM AccountAnomalyStar a JOIN DimSeverity s ON s.id = a.severityId JOIN DimStatus st ON st.id = a.statusId WHERE a.severityId = 3 AND a.date >= '2023-01-01'"
    repeat: 500

  # --- 3 WHERE conditions ---
  - name: "3 cond: severityId + statusId + date"
    query: "SELECT a.id, s.name AS severity, a.date, st.name AS status, a.amount FROM AccountAnomalyStar a JOIN DimSeverity s ON s.id = a.severityId JOIN DimStatus st ON st.id = a.statusId WHERE a.severityId = 3 AND a.statusId = 1 AND a.date >= '2023-01-01'"
    repeat: 500

  # --- 4 WHERE conditions ---
  - name: "4 cond: severityId + statusId + date + amount"
    query: "SELECT a.id, s.name AS severity, a.date, st.name AS status, a.amount FROM AccountAnomalyStar a JOIN DimSeverity s ON s.id = a.severityId JOIN DimStatus st ON st.id = a.statusId WHERE a.severityId = 3 AND a.statusId = 1 AND a.date >= '2023-01-01' AND a.amount > 50"
    repeat: 500

  # --- Off-index queries (no composite starts with these) ---
  - name: "off-index: statusId + date"
    query: "SELECT a.id, s.name AS severity, a.date, st.name AS status FROM AccountAnomalyStar a JOIN DimSeverity s ON s.id = a.severityId JOIN DimStatus st ON st.id = a.statusId WHERE a.statusId = 1 AND a.date >= '2023-01-01'"
    repeat: 500
  - name: "off-index: amount range"
    query: "SELECT a.id, s.name AS severity, a.date, st.name AS status, a.amount FROM AccountAnomalyStar a JOIN DimSeverity s ON s.id = a.severityId JOIN DimStatus st ON st.id = a.statusId WHERE a.amount > 50"
    repeat: 500
  - name: "off-index: statusId + amount"
    query: "SELECT a.id, s.name AS severity, a.date, st.name AS status, a.amount FROM AccountAnomalyStar a JOIN DimSeverity s ON s.id = a.severityId JOIN DimStatus st ON st.id = a.statusId WHERE a.statusId = 1 AND a.amount > 50"
    repeat: 500
